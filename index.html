<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Thunder</title>
    <style>
        /* [Previous CSS content remains exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML content remains exactly the same] -->

    <script>
        // [Previous variable declarations remain the same until userState]

        const userState = {
            deaths: 0,
            equipment: ["bodyweight"],
            battleType: "air",
            currentWorkout: JSON.parse(localStorage.getItem("currentWorkout")) || {
                timestamp: new Date().toISOString(),
                deaths: 0,
                exercises: {
                    arms: [], chest: [], back: [], abs: [], legs: []
                }
            },
            workoutHistory: JSON.parse(localStorage.getItem("workoutHistory")) || {
                arms: { count: 0, lastDone: null },
                chest: { count: 0, lastDone: null },
                back: { count: 0, lastDone: null },
                abs: { count: 0, lastDone: null },
                legs: { count: 0, lastDone: null }
            },
            weakMode: JSON.parse(localStorage.getItem("weakMode")) || {},
            lastDeathCount: 0,
            fromSuccessScreen: false
        };

        // [Previous DOM element declarations remain the same]

        function showSuccessMessage() {
            workoutDisplay.style.display = "none";
            successBox.style.display = "block";
            lastGenerateClick = 0;
            userState.fromSuccessScreen = true;
            
            // Clear the current workout but keep the death count
            userState.currentWorkout = {
                timestamp: new Date().toISOString(),
                deaths: userState.currentWorkout.deaths, // Keep the same death count
                exercises: {
                    arms: [], chest: [], back: [], abs: [], legs: []
                }
            };
            localStorage.setItem("currentWorkout", JSON.stringify(userState.currentWorkout));
        }

        function handleGenerateClick() {
            const now = Date.now();
            
            // Bypass spam prevention if coming from success screen
            if (now - lastGenerateClick < 300 && !userState.fromSuccessScreen) {
                const warning = document.querySelector(".spam-warning");
                if (warning.style.display !== 'block') {
                    warning.style.display = "block";
                    setTimeout(() => warning.style.display = "none", 1500);
                }
                return;
            }
            lastGenerateClick = now;

            if (successBox.style.display === 'block') {
                successBox.style.display = 'none';
            }

            // If coming from success screen, force generate new exercises
            if (userState.fromSuccessScreen) {
                userState.fromSuccessScreen = false;
                const targetDeaths = parseInt(deathCountInput.value) || 1;
                userState.lastDeathCount = 0; // Reset to force generation
                deathCountInput.value = targetDeaths; // Keep the same value
                generateAdditionalExercises(targetDeaths);
                return;
            }

            generateWorkout();
        }

        // [Rest of the JavaScript code remains exactly the same]
    </script>
</body>
</html>
